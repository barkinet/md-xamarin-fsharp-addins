# Makefile for compiling, installing and packaging the F# Mobile Addin for Xamarin Studio >= 4.0.2
#
#   run 'make' to compile the plugin against the installed version of MonoDevelop detected by ./configure.sh
#   run 'make install' to compile and install the plugin against the installed version of MonoDevelop detected by ./configure.sh
#   run 'make pack-all' to create a deployment binary packages for the known set of supported MonoDevelop versions

VERSION=4.0

MDTOOL = $(MONO) 'INSERT_MDROOT/../../mdtool'
MDROOT = INSERT_MDROOT

ANDROID = MonoDevelop.FSharp.Android/MonoDevelop.FSharp.Android.csproj MonoDevelop.FSharp.Android/MonoDevelop.FSharp.Android.addin.xml
MAC = MonoDevelop.FSharp.Mac/MonoDevelop.FSharp.Mac.csproj MonoDevelop.FSharp.Mac/MonoDevelop.FSharp.Mac.addin.xml
IOS = MonoDevelop.FSharp.iOS/MonoDevelop.FSharp.iOS.csproj MonoDevelop.FSharp.iOS/MonoDevelop.FSharp.iOS.addin.xml

# The default configuration is Debug
ifeq ($(config),)
config=Debug
endif

.PHONY: all

all: pack

build: $(ANDROID) $(MAC) $(IOS)
	rm -rf bin/$(config)/packages
	mkdir -p bin/$(config)/packages
	(xbuild md-xamarin-fsharp-addins.sln /p:Configuration=$(config))


pack: build
	-rm -rf pack/$(VERSION)/$(config)
	@-mkdir -p pack/$(VERSION)/$(config)
	$(MDTOOL) setup pack bin/$(config)/MonoDevelop.FSharp.Android/MonoDevelop.FSharp.Android.dll -d:pack/$(VERSION)/$(config)
	$(MDTOOL) setup pack bin/$(config)/MonoDevelop.FSharp.Mac/MonoDevelop.FSharp.Mac.dll -d:pack/$(VERSION)/$(config)
	$(MDTOOL) setup pack bin/$(config)/MonoDevelop.FSharp.iOS/MonoDevelop.FSharp.iOS.dll -d:pack/$(VERSION)/$(config)

install: pack
	$(MDTOOL) setup install -y pack/$(VERSION)/$(config)/MonoDevelop.FSharp.Android_$(VERSION).mpack
	$(MDTOOL) setup install -y pack/$(VERSION)/$(config)/MonoDevelop.FSharp.Mac_$(VERSION).mpack
	$(MDTOOL) setup install -y pack/$(VERSION)/$(config)/MonoDevelop.FSharp.iOS_$(VERSION).mpack

uninstall:
	$(MDTOOL) setup uninstall MonoDevelop.FSharp.Android MonoDevelop.FSharp.Mac MonoDevelop.FSharp.iOS

clean:
	-rm -rf bin
	-rm -rf pack
	-rm -rf MonoDevelop.FSharp.Android/obj
	-rm -rf MonoDevelop.FSharp.Mac/obj
	-rm -rf MonoDevelop.FSharp.iOS/obj
	-find . -name "*~" -exec rm -f {} \;
